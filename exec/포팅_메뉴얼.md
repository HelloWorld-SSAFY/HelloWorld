> 프로젝트: 임산부 케어 앱 (Android + Spring Boot 백엔드, k3s/Kubernetes, PostgreSQL)
> 문서 목적: 새 환경에서도 **즉시 빌드/배포**할 수 있도록 필수 정보와 절차를 표준화한다.

---
## 0) 저장소 구조
```
repo-root/
├─ server/                       # ⇦ 여러 개의 Spring Boot 서버 모듈
│  ├─ userserver/
│  │  ├─ src/… 
│  │  ├─ build.gradle(.kts)
│  │  └─ Dockerfile              # ⇦ 각 서버 폴더마다 Dockerfile 존재
│  ├─ healthserver/
│  │  ├─ src/…
│  │  ├─ build.gradle(.kts)
│  │  └─ Dockerfile
│  ├─ gatewayserver/
│  │  ├─ src/…
│  │  ├─ build.gradle(.kts)
│  │  └─ Dockerfile
│  └─ …(추가 서비스 동일 규칙)
│
├─ k8s/                          # ⇦ Kubernetes 매니페스트
│  ├─ userserver/
│  │  ├─ deployment.yaml
│  │  └─ service.yaml
│  ├─ healthserver/
│  │  ├─ deployment.yaml
│  │  └─ service.yaml
│  ├─ gatewayserver/
│  │  ├─ deployment.yaml
│  │  └─ service.yaml
│  └─ ingress/                   # ⇦ Ingress/미들웨어 등 공통 리소스
│     ├─ traefik-ingress.yaml
│     └─ (필요 시) middleware-*.yaml
│
├─ jenkins/
│  └─ Jenkinsfile                # ⇦ 단일 파이프라인(멀티서비스 빌드/배포)
│
└─ README.md

```
AI Server는 포함되어 있으며 Android는 따로 폴더에 존재.
---
## 1) 사용한 **JVM / 웹서버 / WAS** 및 IDE 버전

| 항목 | 값 | 비고 |
|---|---|---|
| JDK | **gradle:8.10-jdk17** | Build stage와 local 개발환경|
| JDK | **eclipse-temurin:17-jre** | Runtime stage 경량 JRE |
| Gradle | **8.14.3** (Wrapper 사용) | Server gradle |
| Gradle | **8.14.3** | Android gradle |
| Spring Boot | **3.5.5** | - |
| 내장 웹서버 | **Tomcat (Spring Boot embedded)** | 외부 WAS 불필요 |
| IDE | **IntelliJ 2025.02.01 | - |
| 빌드 컨테이너 | `gcr.io/kaniko-project/executor:debug` | CI 이미지 빌드 |
| 오케스트레이션 쿠버네티스 | **v1.33.4+k3s1** | 단일 노드 |
| Ingress | **rancher/mirrored-library-traefik:3.3.6** | Cert-Manager TLS |
| 서비스 디스커버리 | **Spring Cloud + Eureka** | `eurekaserver-svc:8761` |
| DB | **PostgreSQL 16.10 (Debian 16.10-1.pgdg13+1)** | `ai-postgres-svc:5432` 등 서버마다 database |
| Redis | **redis:8.2.1-debian-12-r0** | 공유 redis |
| 모니터링/로깅 | Prometheus/Grafana/Loki | 대시보드/알람 |


> ⚠️ 운영/개발 환경 차이는 “프로필”과 “환경변수”로만 구분한다. 애플리케이션 소스는 동일.

---
2. 의존성 구성

Web, Data JPA, Security, Validation, Mail, Actuator

문서화: springdoc-openapi (Swagger UI)

DB : postgresql 17, redis

인증: JWT(jjwt BOM), Firebase Admin(FCM/Google 로그인)

클라우드/분산: Spring Cloud Config, LoadBalancer, Eureka Client, OpenFeign

스케줄러: DB Scheduler (kagkarlsson)

테스트: Spring Boot Test, Spring Security Test, JUnit

youtube API
https://developers.google.com/youtube/v3?hl=ko

spotify API
https://developers.google.com/youtube/v3?hl=ko

meteo weather API
https://open-meteo.com/

서버 설정 요약

포트/주소: 기본 8080,
Context Path: /

데이터베이스 접속 URL:
https://pgadmin.43.203.238.139.sslip.io/

OpenAI
모델 : delle - 3




환경 변수 필수값

== aiserver-apptoken ==
TOKEN
== aiserver-secret ==
APP_TOKEN
DB_NAME
DB_PASSWORD
DB_USER
DJANGO_SECRET_KEY
GATEWAY_HMAC_SECRET
SPOTIFY_CLIENT_ID
SPOTIFY_CLIENT_SECRET
YOUTUBE_API_KEY
== configserver-git ==
GIT_TOKEN
GIT_USERNAME
== google-oauth-secret ==
CLIENT_ID
CLIENT_SECRET
== postgres-secret ==
POSTGRES_PASSWORD
== redis ==
SPRING_REDIS_PASSWORD
SPRING_REDIS_PORT
SPRING_REDIS_HOST
== userserver-jwt-secret ==
ACCESS_EXPIRE
ACCESS_SECRET
REFRESH_EXPIRE
REFRESH_SECRET
== s3-credentials ==
S3_ACCESSKEY
S3_SECRETKEY

리소스 파일
healthserver/src/main/resources/firebase-service-account.json

yaml 파일은 helloworld-config-repo에서 관리



frontend

헬스 케어 데이터 수집

갤럭시 워치, 스마트 폰에서 삼성 헬스 설치 및 가입 https://play.google.com/store/search?q=삼성헬스&c=apps&hl=ko
스마트 폰에서 헬스 커넥트 설치 https://play.google.com/store/apps/details?id=com.google.android.apps.healthdata&hl=ko

---
## 3) **배포 시 특이사항**
0. **k3s + msa** – 쿠버네티스 내에 띄우기 때문에 Eureka나 gateway 등 특정 기능 서버가 아니면 포트번호가 같음.
   초기 Eureka, Config, Gateway 서버 순서 중요, configserver와 연결되어있는 레포 확인.(`exec/yaml/*.yaml` configserver에서 사용하는 yaml파일들)
1. **Traefik Ingress** – `X-Forwarded-*` 헤더, HTTPS 시 `X-Forwarded-Proto=https` 확인.
2. **Eureka/내부 호출** – `lb://SERVICE-ID` 우선. 게이트웨이 Prefix 중복 제거 주의.
3. **Config 분리** – 민감값은 **Kubernetes Secret**, **Kubernetes ConfigMap**사용
4. **헬스체크** – `health/readiness` 사용, Actuator `prometheus` 노출.
5. **롤링 업데이트** – `readinessProbe` 필수, `maxUnavailable=0` 권장.
6. **모니터링** – Loki/Prometheus/Grafana 연결, CPU/메모리/5xx/P90 알람.

---
## 4) **DB 접속 정보** 및 ERD용 **계정/프로퍼티 파일 목록**
### 4‑1. 접속 정보
| 항목 | 값 |
|---|---|
| Host | `ai-postgres-svc.apps.svc.cluster.local` |
| Port | `5432` |
| Database | `ai_db` |
| User | `postgres` |
| Password | 설정 패스워드 |

**JDBC URL**: `jdbc:postgresql://ai-postgres-svc:5432/ai_db`
여기서 서비스 명만 다르게
| weekly-postgres-svc | `weekly_db` |
| user-postgres-svc | `user_db` |
| health-postgres-svc | `health_db` |
| calendar-postgres-svc | `calendar_db` |

| 항목 | 값 |
|---|---|
| Host | `redis-svc.apps.svc.cluster.local` |
| Port | `6379` |
| Database | `ai_db` |
| Password | 설정 패스워드 |

**JDBC URL**: `jdbc:redis://redis-svc.apps.svc.cluster.local:5432/`


### 4‑2. 계정 정책
- 전부: `postgres` 루트 계정
- 설정 패스워드

### 4‑3. 주요 설정 파일 목록
- `exec/yaml/*.yaml` configserver에서 사용하는 yaml파일들
- `server/src/main/resources/application.yml`
- `k8s/apps/*/deployment.yaml`
- `k8s/apps/*/secret.yaml`
- `server/Jenkinsfile`

---
### 체크리스트

- [ ] JDK/Gradle 버전 일치
- [ ] 환경변수(DB/JWT/AI_TOKEN) 채움
- [ ] Secret 생성 또는 Helm values 주입
- [ ] 헬스체크/롤링업데이트 확인
